<html>
<head>
<!--link href="./assets/css/np.css" type="text/css" rel="stylesheet">
<link href="./assets/css/theme.css" type="text/css" rel="stylesheet">
<link href="./assets/css/font-awesome.css" type="text/css" rel="stylesheet">
<link href="./assets/css/servant-list.css" type="text/css" rel="stylesheet"-->

<!--style>

.wikitable {
    text-align:center;
    max-width:1000px;
    margin:0px;
    background-color: rgba(248,249,250,0.6);
}

.wikitable > tr > th {
    background-color:rgba(234,236,240,0.3)
}


.filter.on .section {
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
}

.filter.on .title {
        font-size: 16px;
        font-weight: bold;
        margin-bottom: 5px;
    }

.filter.on .btn-row {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        justify-content: center;
    }

.filter.on .toggle-btn {
    padding: 4px 12px;
    border-radius: 4px;
    border: none;
    font-weight: 600;
    background: #d8cbcb;
    color: #333;
    cursor: pointer;
    transition: all 0.25s ease;
}

.filter.on .toggle-btn.on {
    background: darkblue;
    color: white;
    font-weight: 400;
    transform: scale(1.05);
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
   -webkit-text-stroke: 1px orange;
    paint-order: stroke fill;
}

    /* 操作按鈕 */
.filter.on .action-btn {
    padding: 5px 20px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: 0.25s;
    color: white;
    background-color: #888;
}


.filter.on .confirm-btn {
        background: #2196f3;
    }

.filter.on .action-btn:hover {
        transform: scale(1.05);
    }

</style>
<style>

div#left {
    width: auto;
    max-width: 35%;
    padding: 20px 10px 20px 20px;
}

div#right {
    width: auto;
    padding: 20px 20px 20px 10px;
}

div#sortMenu {
    width: 100%;
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    border-radius: 10px;
    background-color: rgba(255,255,255,0.6);
}

div#sortMenu span {
    text-wrap: nowrap;
}

.filter #filterButton {
    height: 30px;
    width: 30px;
    min-height: 30px;
    min-width: 30px;
    z-index: 2;
    cursor: pointer;
    padding: 5px;
    margin: 5px;
    border: none;
    background-image: url(assets/images/filter.svg);
    background-color: transparent;
    background-size: cover;
}

.filter.on #sortMenu {
    border-radius: 10px 10px 0 0;
    background-color: unset;
}

.filter.on #filterButton {
    background-image: url(assets/images/cancel.svg);
}

select {
    border: 1px solid #dddddd;
    border-radius: 4px;
    background: #eeeeee;
    padding: 4px;
    transition: 0.3s;
    margin-left: 10px;
}

select:hover{
  background: #dddddd;
}

div#result {
    box-sizing: border-box;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: 10px 3px;
    align-content: baseline;
}

/* 原狀態：只是一個包著按鈕的小容器 */
div.filter {
    position: relative;
    display: flex;
    /* max-height: 50px;
    transition: height 0.3s ease; */
}

div.filter.on {
    position: relative;
    top: 0px;
    left: 0;
    min-width: 100%;
    height: calc(100vh - 40px);
    background: rgb(238, 236, 240, 0.7);
    border-radius: 4px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    z-index: 9999;
    display: flex;
    flex-direction: column;
    /* transition: max-height 1s ease; */
}

div.filter.on+div#result {
    position: relative;
    top: 20px;
}

div.filter.on > .btn-row {
    margin-top: auto;
    padding: 10px 0 5px 0;
}

div.filter > div#filterMenu {
   display: none;
}

div.filter.on > div#filterMenu {
   display: block;
   height: 80%;
}

div.filter.on > div#sortMenu > span.on {
   display: none;
}

div.filter.on > div#sortMenu > span.off {
   display: block;
}


div.filter > div#sortMenu > span.off, p,div.btn-row {
   display: none;
}


div#left:has(>div.filter.on) {
//  height: calc(100vh - 40px);
  overflow-y: clip;
}

span#star {
    color: #FFD500;
    text-shadow: 1px 1px 1px #000000;
    font-size: 110%;
    text-align: center;
}

body > div > div {
      flex: 1; 
        overflow-y: auto; /* 自己的捲軸 */
        box-sizing: border-box;
}

body > div > div#left {
        overflow-x: hidden; /* 自己的捲軸 */
}


body > div {
    display: flex;
    height: 100vh;
}

html, body {
    margin: 0;
    height: 100%;
    overflow: hidden;
}
</style -->
<style>
.fab {
  position: fixed;
  right: 24px;
  bottom: 24px;

  width: 48px;
  height: 48px;

  z-index: 9999;
}

/* 主按鈕 */
.fab-main {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  border: none;

  background: rgba(20,20,20,.4);
  color: #fff;
  font-size: 18px;
  cursor: pointer;

  box-shadow: 0 8px 20px rgba(0,0,0,.35);
  position: relative;
  z-index: 2;

  transition: transform .25s ease;
}

.fab-main:hover {
  background: rgba(20,20,20,.8);
}


/* 子按鈕（關鍵：中心對齊） */
.fab-item {
  position: absolute;
  right: 0;
  bottom: 0;

  width: 48px;
  height: 48px;
  border-radius: 50%;
  border: none;
  background: rgba(20,20,20,.8);
  color: #fff;
  font-size: 16px;
  cursor: pointer;

  box-shadow: 0 6px 16px rgba(0,0,0,.3);

  opacity: 0;
  pointer-events: none;
  transform: scale(.8);

  transition:
    transform .25s ease,
    opacity .25s ease;
}

/* 展開 */
.fab.open .fab-item {
  opacity: 1;
  pointer-events: auto;
}

/* 向上 */
.fab.open .fab-up {
  transform: translateY(-64px);
}

/* 向左 */
.fab.open .fab-left {
  transform: translateX(-64px);
}

/* 主按鈕旋轉（保留前版手感） */
.fab.open .fab-main {
  transform: rotate(360deg);
  background: rgba(20,20,20,.8);
}

.fab-main,
.fab-item {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  border: none;
  cursor: pointer;

  display: flex;
  align-items: center;
  justify-content: center;
  text-decoration: none;


  background: radial-gradient(circle, #d6b56c, #6f5528);
  color: #fff;
  box-shadow: 0 0 12px rgba(214,181,108,.6);
}

/* 主按鈕 */
.fab-main {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  border: none;

  background: rgba(20,20,20,.4);
  color: #fff;
  font-size: 18px;
  cursor: pointer;

  box-shadow: 0 8px 20px rgba(0,0,0,.35);
  position: relative;
  z-index: 2;

  transition: transform .25s ease;
}

.fab-main:hover {
  background: rgba(20,20,20,.8);
}

.fab-item i,
.fab-main i {
  font-size: 18px;
}

a.fab-item:hover {
    color: gold;
}

</style>
<link href="./assets/css/all.css" type="text/css" rel="stylesheet">
<script type="text/javascript" src="./assets/js/servant.js"></script>
</head>
<body>


<div class="container"style="background-image: url(assets/images/Myroom.webp);background-repeat: round;">
<div id="left">
<div class="filter">
<div id="sortMenu">
<button id="filterButton"></button>
<span class="on" style="margin-left: 10px;font-size: 1.2em;font-weight: 700;">從者清單</span>
<span class="off" style="margin-left: 10px;font-size: 1.2em;font-weight: 700;">從者篩選</span>
<span class="on" style="margin-left: auto;">排序依據 
    <select id="sort">
      <!--button>
        <selectedcontent>職階</selectedcontent>
      </button-->
      <option value="0">職階</option>
      <option value="1">COST ▼</option>
      <option value="2">COST ▲</option>
      <option value="3">ATK ▼</option>
      <option value="4">ATK ▲</option>
      <option value="5">HP ▼</option>
      <option value="6">HP ▲</option>
    </select>
</span>
<!--篩選區塊-->
<div class="btn-row" style="padding: 0 5px; margin-left:auto;">
    <button id="all" class="action-btn">全選</button><button id="clear" class="action-btn">清除</button>
</div>
</div>
<div id="filterMenu"><div class="section"><div class="title">從者職階</div><div class="btn-row" id="type"></div></div><div class="section"><div class="title">稀有度</div><div class="btn-row" id="star"><button class="toggle-btn">1A</button><button class="toggle-btn">2B</button><button class="toggle-btn">3C</button><button class="toggle-btn">4D</button><button class="toggle-btn">5E</button></div></div><div class="section"><div class="title">寶具類型</div><div class="btn-row" id="npCard"><button class="toggle-btn">Z</button><button class="toggle-btn">X</button><button class="toggle-btn">Y</button></div></div><div class="section"><div class="title">寶具效果</div><div class="btn-row" id="npType"><button class="toggle-btn">Z</button><button class="toggle-btn">X</button><button class="toggle-btn">Y</button></div></div></div><div class="btn-row"><button class="action-btn confirm-btn">篩選從者</button></div></div>
<!--篩選結果-->
<div id="result">
<div class="servant"><img src="assets/images/servant/head002.png" class="gold"><span class="fit">阿爾托莉亞・潘德拉剛</span></div><div class="servant"><img src="assets/images/servant/head003.png" class="gold"><span class="fit">阿爾托莉亞・潘德拉剛〔Alter〕</span></div><div class="servant"><img src="assets/images/servant/head004.png" class="gold"><span class="fit">阿爾托莉亞・潘德拉剛〔Lily〕</span></div><div class="servant"><img src="assets/images/servant/head005.png" class="gold"><span class="fit">尼祿・克勞狄烏斯</span></div><div class="servant"><img src="assets/images/servant/head006.png" class="gold"><span class="fit">齊格飛</span></div><div class="servant"><img src="assets/images/servant/head007.png" class="silver"><span class="fit">蓋烏斯・尤利烏斯・凱撒</span></div><div class="servant"><img src="assets/images/servant/head008.png" class="gold"><span class="fit">阿蒂拉</span></div><div class="servant"><img src="assets/images/servant/head009.png" class="silver"><span class="fit">吉爾・德・萊斯</span></div><div class="servant"><img src="assets/images/servant/head010.png" class="gold"><span class="fit">騎士德翁</span></div><div class="servant"><img src="assets/images/servant/head011.png" class="gold"><span class="fit">Emiya</span></div><div class="servant"><img src="assets/images/servant/head012.png" class="gold"><span class="fit">吉爾伽美什</span></div><div class="servant"><img src="assets/images/servant/head013.png" class="silver"><span class="fit">羅賓漢</span></div><div class="servant"><img src="assets/images/servant/head014.png" class="gold"><span class="fit">阿塔蘭塔</span></div><div class="servant"><img src="assets/images/servant/head015.png" class="silver"><span class="fit">尤瑞艾莉</span></div><div class="servant"><img src="assets/images/servant/head016.png" class="bronze"><span class="fit">阿拉什</span></div><div class="servant"><img src="assets/images/servant/head017.png" class="silver"><span class="fit">庫・夫林</span></div><div class="servant"><img src="assets/images/servant/head018.png" class="gold"><span class="fit">伊莉莎白・巴托里</span></div><div class="servant"><img src="assets/images/servant/head019.png" class="bronze"><span class="fit">武藏坊弁慶</span></div><div class="servant"><img src="assets/images/servant/head020.png" class="silver"><span class="fit">庫・夫林〔Prototype〕</span></div><div class="servant"><img src="assets/images/servant/head021.png" class="bronze"><span class="fit">列奧尼達一世</span></div><div class="servant"><img src="assets/images/servant/head022.png" class="silver"><span class="fit">羅慕路斯</span></div><div class="servant"><img src="assets/images/servant/head023.png" class="silver"><span class="fit">美杜莎</span></div><div class="servant"><img src="assets/images/servant/head024.png" class="bronze"><span class="fit">聖喬治</span></div><div class="servant"><img src="assets/images/servant/head025.png" class="bronze"><span class="fit">愛德華・蒂奇</span></div><div class="servant"><img src="assets/images/servant/head026.png" class="silver"><span class="fit">布狄卡</span></div><div class="servant"><img src="assets/images/servant/head027.png" class="silver"><span class="fit">牛若丸</span></div><div class="servant"><img src="assets/images/servant/head028.png" class="silver"><span class="fit">亞歷山大</span></div><div class="servant"><img src="assets/images/servant/head029.png" class="gold"><span class="fit">瑪莉・安東尼</span></div><div class="servant"><img src="assets/images/servant/head030.png" class="gold"><span class="fit">瑪爾大</span></div><div class="servant"><img src="assets/images/servant/head031.png" class="silver"><span class="fit">美狄亞</span></div><div class="servant"><img src="assets/images/servant/head032.png" class="silver"><span class="fit">吉爾・德・萊斯</span></div><div class="servant"><img src="assets/images/servant/head033.png" class="bronze"><span class="fit">漢斯・克里斯蒂安・安徒生</span></div><div class="servant"><img src="assets/images/servant/head034.png" class="bronze"><span class="fit">威廉・莎士比亞</span></div><div class="servant"><img src="assets/images/servant/head035.png" class="silver"><span class="fit">梅菲斯托費勒斯</span></div><div class="servant"><img src="assets/images/servant/head036.png" class="bronze"><span class="fit">沃夫岡・阿瑪迪斯・莫札特</span></div><div class="servant"><img src="assets/images/servant/head037.png" class="gold"><span class="fit">諸葛孔明〔埃爾梅羅II世〕</span></div><div class="servant"><img src="assets/images/servant/head038.png" class="silver"><span class="fit">庫・夫林</span></div><div class="servant"><img src="assets/images/servant/head039.png" class="bronze"><span class="fit">佐佐木小次郎</span></div><div class="servant"><img src="assets/images/servant/head040.png" class="bronze"><span class="fit">咒腕的哈桑</span></div><div class="servant"><img src="assets/images/servant/head041.png" class="gold"><span class="fit">絲忒諾</span></div><div class="servant"><img src="assets/images/servant/head042.png" class="silver"><span class="fit">荊軻</span></div><div class="servant"><img src="assets/images/servant/head043.png" class="bronze"><span class="fit">夏爾＝亨利・桑松</span></div><div class="servant"><img src="assets/images/servant/head044.png" class="bronze"><span class="fit">歌劇魅影</span></div><div class="servant"><img src="assets/images/servant/head045.png" class="bronze"><span class="fit">瑪塔・哈里</span></div><div class="servant"><img src="assets/images/servant/head046.png" class="gold"><span class="fit">卡米拉</span></div><div class="servant"><img src="assets/images/servant/head047.png" class="gold"><span class="fit">赫拉克勒斯</span></div><div class="servant"><img src="assets/images/servant/head048.png" class="gold"><span class="fit">蘭斯洛特</span></div><div class="servant"><img src="assets/images/servant/head049.png" class="silver"><span class="fit">呂布奉先</span></div><div class="servant"><img src="assets/images/servant/head050.png" class="bronze"><span class="fit">斯巴達克斯</span></div><div class="servant"><img src="assets/images/servant/head051.png" class="gold"><span class="fit">坂田金時</span></div><div class="servant"><img src="assets/images/servant/head052.png" class="gold"><span class="fit">弗拉德三世</span></div><div class="servant"><img src="assets/images/servant/head053.png" class="bronze"><span class="fit">阿斯忒里翁</span></div><div class="servant"><img src="assets/images/servant/head054.png" class="bronze"><span class="fit">卡利古拉</span></div><div class="servant"><img src="assets/images/servant/head055.png" class="silver"><span class="fit">大流士三世</span></div><div class="servant"><img src="assets/images/servant/head056.png" class="silver"><span class="fit">清姬</span></div><div class="servant"><img src="assets/images/servant/head057.png" class="bronze"><span class="fit">血斧・埃里克</span></div><div class="servant"><img src="assets/images/servant/head058.png" class="gold"><span class="fit">玉藻貓</span></div><div class="servant"><img src="assets/images/servant/head060.png" class="gold"><span class="fit">俄里翁</span></div><div class="servant"><img src="assets/images/servant/head061.png" class="gold"><span class="fit">伊莉莎白・巴托里〔萬聖節〕</span></div><div class="servant"><img src="assets/images/servant/head062.png" class="gold"><span class="fit">玉藻前</span></div><div class="servant"><img src="assets/images/servant/head063.png" class="silver"><span class="fit">大衛</span></div><div class="servant"><img src="assets/images/servant/head064.png" class="silver"><span class="fit">赫克特</span></div><div class="servant"><img src="assets/images/servant/head065.png" class="gold"><span class="fit">弗朗西斯・德雷克</span></div><div class="servant"><img src="assets/images/servant/head066.png" class="gold"><span class="fit">安妮・伯妮＆瑪莉・瑞德</span></div><div class="servant"><img src="assets/images/servant/head067.png" class="gold"><span class="fit">美狄亞〔Lily〕</span></div><div class="servant"><img src="assets/images/servant/head068.png" class="gold"><span class="fit">沖田總司</span></div><div class="servant"><img src="assets/images/servant/head069.png" class="gold"><span class="fit">織田信長</span></div><div class="servant"><img src="assets/images/servant/head070.png" class="gold"><span class="fit">斯卡薩哈</span></div><div class="servant"><img src="assets/images/servant/head071.png" class="silver"><span class="fit">迪爾姆德・奧德利暗</span></div><div class="servant"><img src="assets/images/servant/head072.png" class="silver"><span class="fit">弗格斯・馬克・羅伊</span></div><div class="servant"><img src="assets/images/servant/head073.png" class="gold"><span class="fit">阿爾托莉亞・潘德拉剛〔聖誕Alter〕</span></div><div class="servant"><img src="assets/images/servant/head074.png" class="gold"><span class="fit">童謠</span></div><div class="servant"><img src="assets/images/servant/head075.png" class="gold"><span class="fit">開膛手傑克</span></div><div class="servant"><img src="assets/images/servant/head076.png" class="gold"><span class="fit">莫德雷德</span></div><div class="servant"><img src="assets/images/servant/head077.png" class="gold"><span class="fit">尼古拉・特斯拉</span></div><div class="servant"><img src="assets/images/servant/head078.png" class="gold"><span class="fit">阿爾托莉亞・潘德拉剛〔Alter〕</span></div><div class="servant"><img src="assets/images/servant/head079.png" class="silver"><span class="fit">馮・霍恩海姆・帕拉塞爾斯</span></div><div class="servant"><img src="assets/images/servant/head080.png" class="silver"><span class="fit">查爾斯・巴貝奇</span></div><div class="servant"><img src="assets/images/servant/head081.png" class="silver"><span class="fit">亨利・傑基爾＆海德</span></div><div class="servant"><img src="assets/images/servant/head082.png" class="gold"><span class="fit">弗蘭肯斯坦</span></div><div class="servant"><img src="assets/images/servant/head084.png" class="gold"><span class="fit">阿周那</span></div><div class="servant"><img src="assets/images/servant/head085.png" class="gold"><span class="fit">迦爾納</span></div><div class="servant"><img src="assets/images/servant/head086.png" class="gold"><span class="fit">謎之女主角X</span></div><div class="servant"><img src="assets/images/servant/head087.png" class="gold"><span class="fit">芬恩・麥克庫爾</span></div><div class="servant"><img src="assets/images/servant/head088.png" class="gold"><span class="fit">布倫希爾德</span></div><div class="servant"><img src="assets/images/servant/head089.png" class="gold"><span class="fit">貝奧武夫</span></div><div class="servant"><img src="assets/images/servant/head090.png" class="gold"><span class="fit">尼祿・克勞狄烏斯〔Bride〕</span></div><div class="servant"><img src="assets/images/servant/head091.png" class="gold"><span class="fit">兩儀式</span></div><div class="servant"><img src="assets/images/servant/head092.png" class="gold"><span class="fit">兩儀式</span></div><div class="servant"><img src="assets/images/servant/head094.png" class="gold"><span class="fit">阿斯托爾福</span></div><div class="servant"><img src="assets/images/servant/head095.png" class="silver"><span class="fit">子吉爾</span></div><div class="servant"><img src="assets/images/servant/head097.png" class="gold"><span class="fit">南丁格爾</span></div><div class="servant"><img src="assets/images/servant/head098.png" class="gold"><span class="fit">庫・夫林〔Alter〕</span></div><div class="servant"><img src="assets/images/servant/head099.png" class="gold"><span class="fit">女王梅芙</span></div><div class="servant"><img src="assets/images/servant/head100.png" class="gold"><span class="fit">海倫娜・布拉瓦茨基</span></div><div class="servant"><img src="assets/images/servant/head101.png" class="gold"><span class="fit">羅摩</span></div><div class="servant"><img src="assets/images/servant/head102.png" class="gold"><span class="fit">李書文</span></div><div class="servant"><img src="assets/images/servant/head103.png" class="gold"><span class="fit">湯瑪斯・愛迪生</span></div><div class="servant"><img src="assets/images/servant/head104.png" class="silver"><span class="fit">傑羅尼莫</span></div><div class="servant"><img src="assets/images/servant/head105.png" class="silver"><span class="fit">比利小子</span></div>
        <div class="space"></div><div class="space"></div><div class="space"></div><div class="space"></div><div class="space"></div><div class="space"></div>
    </div>
    <div id="rest" style="display: none;"></div>
</div>
<div id="right" style="min-width: min-content;">
    <table class="wikitable" style="text-align:center;max-width:1000px;margin:0px;background-color:rgba(248,249,250,0.6);"><tbody></tbody></table>
</div>
</div>
<!--div class="fab">
  <button class="fab-main" id="fabToggle" aria-label="快速導航">☰</button>
  <button class="fab-item fab-up" data-action="top" aria-label="回到頂端">▲</button>
  <button class="fab-item fab-left" data-action="servant" aria-label="跳到從者"></button>
</div-->
<div class="fab">
  <!-- 主按鈕：只控制展開，不導頁 -->
  <button class="fab-main" id="fabToggle" aria-label="快速導航">
    <i class="fa fa-trophy"></i>
  </button>

  <!-- 回到頂端 -->
  <a href="index.html" class="fab-item fab-up" style="text-decoration: none;" aria-label="回到頂端">
    <i class="fa fa-home"></i>
  </a>

  <!-- 跳到從者區 -->
  <a href="page2.html" class="fab-item fab-left" style="text-decoration: none;" aria-label="前往從者">
    <span style="font-size:140%; font-weight:700">⚔</span>
  </a>
</div>

<script src="assets/js/resize.js"></script>
<script>
    function showIntro(uid) {
        let s = servant[uid], t = [];
        const type = ["Archer","Saber","Lancer","Rider","Caster","Assassin","Berserker"], card = ["Arts","Quick","Buster"];
        const cost = [0,3,4,9,12,16], npT = ["self","enemy","enemy-all","friendly-all","stars"];
        
        t.push(`<tr style="font-size: 130%;"><th colspan="6">${s.name}</th><th rowspan="3"><img height="18" src="./assets/images/icon/${s.star}star.png"><br><img width="50" height="50" src="./assets/images/icon/${type[s.type].toLowerCase()}.png"></th></tr>`);
        t.push(`<tr><th style="width:90px">職階</th><th style="width:90px">性別</th><th style="width:90px">身高</th><th style="width:90px">體重</th><th style="width:90px">屬性</th><th style="width:90px">副屬性</th></tr><tr><td>${type[s.type]}</td>`);
        t.push(s.info.split("|").map(a=>`<td>${a}</td>`).join(""));
        t.push(`</tr><tr><th>筋力</th><th>耐久</th><th>敏捷</th><th>魔力</th><th>幸運</th><th>寶具</th><th rowspan="11"><img width="285" height="403" src="./assets/images/servant/card${uid}.png"></th></tr><tr>`);
        t.push(s.stat.split("|").map(a=>`<td>${a}</td>`).join(""));
        t.push(`</tr><tr><th colspan="5">指令卡</th><th>COST</th></tr><tr><td colspan="5" rowspan="1" style="align-content: space-between;">`);
        t.push(s.card.toString().split("").map(a=>`<img src="./assets/images/icon/${card[a].toLowerCase()}.png" width="50" height="50" style="align-content: space-between;">`).join(""));
        t.push(`</td><td>${cost[s.star]}</td></tr><tr><th colspan="5">主動技能</th><th style="white-space: nowrap;">CD回合</th></tr><tr class="skill">`);
        t.push(s.skill.map(a=>`<th><img src="./assets/images/icon/skill${a.id}.png" width="40" height="40"></th><td colspan="4" style="text-align: left;"><strong style="line-height: 150%;">${a.name}</strong><br><span style="font-size: 80%">${a.note}</span></td><td>${a.cdr}</td></tr><tr>`).join(""));
        t.push(`<th>能力</th><th>基礎</th><th>滿級</th><th>90級</th><th>100級</th><th>120級</th></tr><tr><th>ATK</th>`);
        t.push([s.ATKs,s.HPs].map(a=>a.map(b=>`<td>${b}</td>`).join("")).join("</tr><tr><th>HP</th>"));
        t.push(`</tr><!--tr><th colspan="7">寶具</th></tr--><tr class="npname-bg ${card[s.np.card]}"><td colspan="7"><div class="npname-name" style="width: auto; padding-inline: 20%;display: flex; justify-content: space-evenly;align-items: center;">`);
        t.push(`寶具<img src="./assets/images/icon/${card[s.np.card]}.png" width="60" height="60">${s.np.name.split("|").join("<br>")}</div></td></tr>`);
        t.push(s.np.effects.map(a=>`<tr><th class="nptarget nptar-${npT[a.id]}" colspan="7">${a.note}</th></tr>`).join("").concat("</tbody>"));

        t = t.join("");
        document.querySelector("table.wikitable").innerHTML = t;
    }

    /*box = document.querySelector('div#result');
    Object.keys(servant).forEach(x=>{
        let a = servant[x], sClass = [, "bronze","bronze","silver","gold","gold"];
        box.innerHTML += `<div class="servant"><img src="assets/images/servant/head${x}.png" class="servant ${sClass[a.star]}"><span class="fit">${a.name}</span></div>`;
    });*/
    showIntro("002")
</script>
<script>
    const fgoStatus = {
        filter: {
            type: [], star: [], npCard: [], npType: []
        }, filterFunc: {
            type: arr => arr.filter(id => fgoStatus.filter.type.indexOf(servant[id].type.toString()) >= 0),
            star: arr => arr.filter(id => fgoStatus.filter.star.indexOf(servant[id].star.toString()) >= 0),
            npCard: arr => arr.filter(id => fgoStatus.filter.npCard.indexOf(servant[id].np.card.toString()) >= 0),
            npType: arr => arr.filter(id => fgoStatus.filter.npType.indexOf(servant[id].np.type.toString()) >= 0)
        }
    };

    fgoStatus.result = [].slice.call(document.querySelectorAll('div#result img')).map(x=>{
        let y = x.src.slice(-7,-4); servant[y].icon = x.parentElement; return x.parentElement.id = y;
    });

    ["div#type|Archer,Saber,Lancer,Rider,Caster,Assassin,Berserker", "div#star|5,4,3,2,1", "div#npCard|Arts,Quick,Buster", "div#npType|輔助,單體攻擊,全體攻擊"].forEach( (x, i) => {
        let [k, v] = x.split("|");
        switch (i) {
            case 0:
                v = v.split(",").reduce((s,a,b)=>(s+=`<button class="toggle-btn" value="${b}">${a}</button>`),""); break;
            case 1:
                v = v.split(",").reduce((s,a,b)=>(s+=`<button class="toggle-btn" value="${a}">${a} ★</button>`),""); break;
            default:
                v = v.split(",").map((a,b)=>`<button class="toggle-btn" value="${b}">${a}寶具</button>`).reverse().join("");
        }
        document.querySelector(k).innerHTML = v; //增加篩選器按鈕
    });
    
    function sort() {
        let e= document.querySelector("select#sort").value, func = [(a, b) => (servant[a].type - servant[b].type),
        (a, b) => (servant[b].star == servant[a].star ? 0 : servant[b].star > servant[a].star ? 1 : -1),
        (a, b) => (servant[b].star == servant[a].star ? 0 : servant[b].star < servant[a].star ? 1 : -1),
        (a, b) => (servant[a].ATKs[1] == servant[b].ATKs[1] ? 0 : servant[a].ATKs[1] < servant[b].ATKs[1] ? 1 : -1),
        (a, b) => (servant[a].ATKs[1] == servant[b].ATKs[1] ? 0 : servant[a].ATKs[1] > servant[b].ATKs[1] ? 1 : -1),
        (a, b) => (servant[a].HPs[1] == servant[b].HPs[1] ? 0 : servant[a].HPs[1] < servant[b].HPs[1] ? 1 : -1),
        (a, b) => (servant[a].HPs[1] == servant[b].HPs[1] ? 0 : servant[a].HPs[1] > servant[b].HPs[1] ? 1 : -1),
        (a, b) => (a - b)][e]; e = document.querySelector('div#result');

        fgoStatus.result = fgoStatus.result.sort().sort(func); //update status
        fgoStatus.result.reverse().forEach(a => e.prepend(servant[a].icon)); //display sorted icons
    }

    //左上角按鈕動作
    document.getElementById("filterButton").addEventListener('click', e => {
        let el = e.currentTarget.parentElement.parentElement.classList;
        el.toggle('on');
        if (el.contains("on")) return; //else: 用戶直接關閉過濾器，需還原成原來的樣子
        Object.entries(fgoStatus.filter).forEach(e => {
            let [k, v] = e;
            document.querySelectorAll('div#'+ k +' button').forEach(el => {
                el.classList.remove("on");
                if (v.indexOf(el.value) >= 0) el.classList.add("on");
            });
        });
    });

    //利用泡泡監聽從者圖示點擊事件
    document.querySelector("div#result").addEventListener('click', e => {
        let target = e.srcElement;
        target = target.tagName == "DIV" ? target.id : target.parentElement.id;
        return target.length ? showIntro(target) : null;
    });

    // 排序選單條件變更監聽
    document.querySelector("select#sort").addEventListener('change', sort);

    // 所有 toggle 按鈕加上切換效果
    document.querySelectorAll(".toggle-btn").forEach(btn => {
        btn.addEventListener("click", () => {
            btn.classList.toggle("on");
        });
    });

    // 全部選擇/cancel
    document.querySelector("div#sortMenu > div.btn-row").addEventListener("click", (e) => {
        if (e.srcElement.tagName != "BUTTON") return;
        document.querySelectorAll(".toggle-btn").forEach(btn => {
            if (e.srcElement.id == "all") btn.classList.add("on");
            else btn.classList.remove("on");
        });
    });

    document.querySelector("button.confirm-btn").addEventListener('click', evt => {
        let el = document.querySelector("div#rest");

        //篩選器動作1: 將所有從者全部移到隱藏區，等篩選完後秀出結果
        document.querySelectorAll("div#result > div.servant").forEach(e => el.append(e));
        //篩選器動作2: 將所有從者代號重加入被篩選範圍內
        fgoStatus.result = Object.keys(servant).sort();
        //篩選器動作3: 將篩選條件寫入暫存器，並使用篩選函式挑出符合條件的從者
        Object.entries(fgoStatus.filterFunc).forEach(e => {
            let [id, func] = e, tag = "div#" + id;
            fgoStatus.filter[id].length = 0; //篩選器條件暫存旗標歸零 -> //寫入生效的篩選器條件
            document.querySelectorAll(tag + " button.on").forEach(x => fgoStatus.filter[id].push(x.value));
            //如果全選或全部不選(不篩選該條件)就跳過該篩選函式
            if (fgoStatus.filter[id].length % document.querySelector(tag).children.length == 0) return;
            else fgoStatus.result = func.call(null, fgoStatus.result);
        });
        //篩選器動作4: 篩選出從者後，依照選單上的選項排序後，將從者加回到顯示區內
        sort();
        document.querySelector("div.filter").classList.remove("on"); //關閉篩選頁面
    });

    if (location.search.length > 0) {
        let e = location.search.split("=").pop();
        if (e.length == 3 && servant[e]) showIntro(e);
        if (e.length == 1 && "0123456".includes(e)) {
            fgoStatus.filter.type.push(e);
            document.querySelector('button.toggle-btn[value="' + e + '"').classList.add("on");
            e = document.querySelector("div#rest");
            document.querySelectorAll("div#result > div.servant").forEach(x => e.append(x));
            fgoStatus.result = fgoStatus.filterFunc.type.call(null, fgoStatus.result);
            sort();
        }
    }
</script>
<script>
const fab = document.querySelector('.fab');
const toggle = document.getElementById('fabToggle');

toggle.addEventListener('click', () => {
  fab.classList.toggle('open');
});

document.querySelectorAll('.fab-item').forEach(btn => {
  btn.addEventListener('click', () => {
    const action = btn.dataset.action;

    fab.classList.remove('open');

    if (action === 'top') {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    if (action === 'servant') {
      document.getElementById('servantSection')?.scrollIntoView({
        behavior: 'smooth'
      });
    }
  });
});
</script>

</body></html>